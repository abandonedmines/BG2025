<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GeoJSON Drag & Drop Viewer</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100vh; }
    #dropzone {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 999;
      background: rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      color: #fff;
      border: 3px dashed #fff;
      pointer-events: none;
      opacity: 0;
      transition: 0.3s;
    }
    #dropzone.active {
      pointer-events: auto;
      opacity: 1;
    }
  </style>
  <!-- ✅ 카카오맵 API 로드 -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9e36db09e57011893c10d8a46f344a7f&autoload=false"></script>
</head>
<body>
  <div id="map"></div>
  <div id="dropzone">📂 GeoJSON 파일을 여기에 드래그하세요</div>

  <script>
    kakao.maps.load(function () {
      const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(36.460980, 127.615083),
        level: 4,
        mapTypeId: kakao.maps.MapTypeId.HYBRID
      });

      const dropzone = document.getElementById('dropzone');

      // ✅ 드래그 동작 기본 막기
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt =>
        document.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
        })
      );

      document.addEventListener('dragover', () => dropzone.classList.add('active'));
      document.addEventListener('dragleave', () => dropzone.classList.remove('active'));

      document.addEventListener('drop', e => {
        dropzone.classList.remove('active');
        const file = e.dataTransfer.files[0];
        console.log('📁 드래그된 파일:', file);

        if (!file || !file.name.endsWith('.geojson')) {
          alert('GeoJSON 파일만 지원됩니다.');
          return;
        }

        const reader = new FileReader();
        reader.onload = () => {
          try {
            console.log('📄 파일 내용 로드됨');
            const geojson = JSON.parse(reader.result);
            console.log('✅ 파싱된 GeoJSON:', geojson);
            drawGeoJSON(geojson);
          } catch (err) {
            console.error('❌ JSON 파싱 실패:', err);
            alert('유효한 GeoJSON 파일이 아닙니다.');
          }
        };
        reader.readAsText(file);
      });

      function drawGeoJSON(geojson) {
        geojson.features.forEach(feature => {
          const type = feature.geometry.type;
          const coords = feature.geometry.coordinates;

          if (type === 'Polygon' || type === 'MultiPolygon') {
            const polygons = type === 'Polygon' ? [coords] : coords;
            polygons.forEach(polygon => {
              polygon.forEach(ring => {
                const path = ring.map(([lng, lat]) => new kakao.maps.LatLng(lat, lng));
                new kakao.maps.Polygon({
                  path,
                  strokeWeight: 2,
                  strokeColor: '#FF0000',
                  fillColor: 'rgba(255,0,0,0.4)',
                  fillOpacity: 0.6
                }).setMap(map);
              });
            });
          }

          if (type === 'LineString') {
            const path = coords.map(([lng, lat]) => new kakao.maps.LatLng(lat, lng));
            new kakao.maps.Polyline({
              path,
              strokeWeight: 3,
              strokeColor: '#0000FF',
              strokeOpacity: 0.7
            }).setMap(map);
          }

          if (type === 'Point') {
            const [lng, lat] = coords;
            new kakao.maps.Marker({
              position: new kakao.maps.LatLng(lat, lng)
            }).setMap(map);
          }
        });
      }
    });
  </script>
</body>
</html>